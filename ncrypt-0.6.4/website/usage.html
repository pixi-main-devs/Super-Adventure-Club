<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>NCrypt - Usage Examples</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="ncrypt-usage-examples">
<h1 class="title">NCrypt - Usage Examples</h1>
<p>Examples are provided for the following modules:</p>
<ul>
<li><dl class="first docutils">
<dt><a class="reference" href="#ncrypt-digest">ncrypt.digest</a> - <em>hash algorithms</em></dt>
<dd><ul class="first last simple">
<li><a class="reference" href="#compute-hash">compute hash</a></li>
<li><a class="reference" href="#compute-hash-for-large-data">compute hash for large data</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference" href="#ncrypt-cipher">ncrypt.cipher</a> - <em>symmetric key encryption/decryption</em></dt>
<dd><ul class="first last simple">
<li><a class="reference" href="#show-cipher-information">show cipher information</a></li>
<li><a class="reference" href="#encrypt-decrypt">encrypt/decrypt</a></li>
<li><a class="reference" href="#encrypt-decrypt-large-data">encrypt/decrypt large data</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference" href="#ncrypt-rsa">ncrypt.rsa</a> - <em>public key crypto using RSA</em></dt>
<dd><ul class="first last simple">
<li><a class="reference" href="#generate-rsa-key">generate RSA key</a></li>
<li><a class="reference" href="#convert-to-pem">convert to PEM</a></li>
<li><a class="reference" href="#encrypt-with-public-key">encrypt with public key</a></li>
<li><a class="reference" href="#decrypt-with-private-key">decrypt with private key</a></li>
<li><a class="reference" href="#sign-with-private-key">sign with private key</a></li>
<li><a class="reference" href="#verify-signature-with-public-key">verify signature with public key</a></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><a class="reference" href="#ncrypt-dh">ncrypt.dh</a> - <em>diffie-hellman key exchange</em></p>
</li>
<li><p class="first"><a class="reference" href="#ncrypt-x509">ncrypt.x509</a> - <em>create/manipulate X.509 certificates used in SSL</em></p>
</li>
<li><p class="first"><a class="reference" href="#ncrypt-ssl">ncrypt.ssl</a> - <em>SSL/TLS network protocol</em></p>
</li>
</ul>
<div class="section">
<h1><a id="ncrypt-digest" name="ncrypt-digest">ncrypt.digest</a></h1>
<ul class="simple">
<li><a class="reference" href="#compute-hash">compute hash</a></li>
<li><a class="reference" href="#compute-hash-for-large-data">compute hash for large data</a></li>
</ul>
<p><span class="target" id="compute-hash">compute hash</span>:</p>
<pre class="literal-block">
from ncrypt.digest import DigestType, Digest

sha256Type = DigestType( 'SHA256' )

def calc_sha256( data ) :
    d = Digest( sha256Type )
    return d.digest( data )
</pre>
<p><span class="target" id="compute-hash-for-large-data">compute hash for large data</span>:</p>
<pre class="literal-block">
md5Type = DigestType( 'MD5' )

def calc_md5( file_obj ) :
    d = Digest( md5Type )
    while 1 :
        data = file_obj.read( 65536 )
        if not data : break
        d.update( data )
    return d.digest()
</pre>
</div>
<div class="section">
<h1><a id="ncrypt-cipher" name="ncrypt-cipher">ncrypt.cipher</a></h1>
<ul class="simple">
<li><a class="reference" href="#show-cipher-information">show cipher information</a></li>
<li><a class="reference" href="#encrypt-decrypt">encrypt/decrypt</a></li>
<li><a class="reference" href="#encrypt-decrypt-large-data">encrypt/decrypt large data</a></li>
</ul>
<p><span class="target" id="show-cipher-information">show cipher information</span>:</p>
<pre class="literal-block">
from ncrypt.cipher import CipherType

def show_info( algo, mode ) :
    ct = CipherType( algo, mode )
    print 'name = %s' % ct.name()
    print 'blockSize = %d bits' % (ct.blockSize()*8)
    print 'keyLength = %d bits' % (ct.keyLength()*8)
    print 'ivLength = %d bits' % (ct.ivLength()*8)

&gt;&gt;&gt; show_info( 'AES-128', 'CBC' )
name = AES-128-CBC
blockSize = 128 bits
keyLength = 128 bits
ivLength = 128 bits

&gt;&gt;&gt; show_info( 'AES-256', 'CBC' )
name = AES-256-CBC
blockSize = 128 bits
keyLength = 256 bits
ivLength = 128 bits

&gt;&gt;&gt; show_info( 'BF', 'CBC' )
name = BF-CBC
blockSize = 64 bits
keyLength = 128 bits
ivLength = 64 bits
</pre>
<p><span class="target" id="encrypt-decrypt">encrypt/decrypt</span>:</p>
<pre class="literal-block">
from ncrypt.cipher import EncryptCipher, DecryptCipher

def do_encrypt( cipherType, key, iv, plain_text ) :
    enc = EncryptCipher( cipherType, key, iv )
    cipher_text = enc.finish( plain_text )
    return cipher_text

def do_decrypt( cipherType, key, iv, cipher_text ) :
    dec = DecryptCipher( cipherType, key, iv )
    plain_text = dec.finish( cipher_text )
    return plain_text

&gt;&gt;&gt; from ncrypt.cipher import CipherType
&gt;&gt;&gt; ct = CipherType( 'AES-128', 'CBC' )
&gt;&gt;&gt; key = 'a' * ct.keyLength()   # dummy key
&gt;&gt;&gt; iv = 'b' * ct.ivLength()     # dummy initial-vector
&gt;&gt;&gt; plain_text = 'my secret'
&gt;&gt;&gt;
&gt;&gt;&gt; enc = EncryptCipher( ct, key, iv )
&gt;&gt;&gt; cipher_text = enc.finish( plain_text )
&gt;&gt;&gt; cipher_text
'\xee\xef\xa6\xa2b\xa7\xbd\x17f\xf7HI\xbcd\xb9c'
&gt;&gt;&gt;
&gt;&gt;&gt; dec = DecryptCipher( ct, key, iv )
&gt;&gt;&gt; new_plain_text = dec.finish( cipher_text )
&gt;&gt;&gt; new_plain_text
'my secret'

# when trying to decrypt invalid cipher text
# CipherError is thrown

&gt;&gt;&gt; dec = DecryptCipher( ct, key, iv )
&gt;&gt;&gt; dec.finish( 'blah' )
ncrypt_cipher.CipherError: error in cipher operation (wrong final block length)
</pre>
<p><span class="target" id="encrypt-decrypt-large-data">encrypt/decrypt large data</span>:</p>
<pre class="literal-block">
from ncrypt.cipher import EncryptCipher, DecryptCipher

def encrypt_file( cipherType, key, iv, in_file, out_file ) :
    enc = EncryptCipher( cipherType, key, iv )
    while 1 :
        data = in_file.read( 8192 )
        if not data : break
        out_data = enc.update( data )
        out_file.write( out_data )
    final_data = enc.finish()
    out_file.write( final_data )

def decrypt_file( cipherType, key, iv, in_file, out_file ) :
    dec = DecryptCipher( cipherType, key, iv )
    while 1 :
        data = in_file.read( 8192 )
        if not data : break
        out_data = dec.update( data )
        out_file.write( out_data )
    final_data = dec.finish()
    out_file.write( final_data )
</pre>
</div>
<div class="section">
<h1><a id="ncrypt-rsa" name="ncrypt-rsa">ncrypt.rsa</a></h1>
<ul class="simple">
<li><a class="reference" href="#generate-rsa-key">generate RSA key</a></li>
<li><a class="reference" href="#convert-to-pem">convert to PEM</a></li>
<li><a class="reference" href="#encrypt-with-public-key">encrypt with public key</a></li>
<li><a class="reference" href="#decrypt-with-private-key">decrypt with private key</a></li>
<li><a class="reference" href="#sign-with-private-key">sign with private key</a></li>
<li><a class="reference" href="#verify-signature-with-public-key">verify signature with public key</a></li>
</ul>
<p><span class="target" id="generate-rsa-key">generate RSA key</span>:</p>
<pre class="literal-block">
&gt;&gt;&gt; from ncrypt.rsa import RSAKey
&gt;&gt;&gt;
&gt;&gt;&gt; key1 = RSAKey()
&gt;&gt;&gt; key1.generate( bits=1024 )

&gt;&gt;&gt; key2 = RSAKey()
&gt;&gt;&gt; key2.generate( bits=2048 )
</pre>
<p><span class="target" id="convert-to-pem">convert to PEM</span>:</p>
<pre class="literal-block">
&gt;&gt;&gt; public_key_data = key1.toPEM_PublicKey()
&gt;&gt;&gt; print public_key_data
-----BEGIN RSA PUBLIC KEY-----
MIGHAoGBAMRU0a9uJviPv845ksWO4LLnxzGNhaUgAEXv0tU+q48qaPFiRQ2h0ygJ
0AHgSCGjslJumbZKBOaWWTChAwrdqH6bEFN10jPk4n4LlzHR/qayy68QQjQtzI9m
GqejD6bK1FZKw7+Weg9AiXkLKFSAtPDVdUz+IZjwO/4pGDXaLE2ZAgEF
-----END RSA PUBLIC KEY-----

&gt;&gt;&gt; private_key_data = key1.toPEM_PrivateKey()
&gt;&gt;&gt; print private_key_data
-----BEGIN RSA PRIVATE KEY-----
MIICWwIBAAKBgQDEVNGvbib4j7/OOZLFjuCy58cxjYWlIABF79LVPquPKmjxYkUN
odMoCdAB4Egho7JSbpm2SgTmllkwoQMK3ah+mxBTddIz5OJ+C5cx0f6mssuvEEI0
LcyPZhqnow+mytRWSsO/lnoPQIl5CyhUgLTw1XVM/iGY8Dv+KRg12ixNmQIBBQKB
gQCdEKe/i1Jgcv/YLg8Eck1b7J9a154dszNrJkJEMiLY7rpatQQK59wgB9mbGdNO
HI6oWHr4Ozce3q3AgM875IbKRz/gO80bvb8xipcYjFj9XpRlt2A32Y+oJhprVGCf
e/VWjtJGS11lFvfqQ095kKuis+6eEoCeikIlngqLmJ9FHQJBAPQYdVjCprsqMaJG
AdE4mousFb4D27MQWnF20LIlrhh2vDo/ioQcaPE1qwS4l4E/eyc1P2/I3sxmEmPw
SIdd14MCQQDN6AXSTyp8iU58FFFRVs9w5hotBhKqyKLFAtDHcTFXau3d/V00KOfy
nekyTGUKnupNVcf3N/P3Azy/mr7UB1+zAkEAknUTNUGXPRlQ+vbN4+7DIJpzcgJQ
nqNpd0dKBH0CDq2kIvLstaqlXYaZz6H0gL+wSrmMdkVSeqOkolz4UThOGwJAUlzP
IOx3ZQO4/m6G7VXsk489q5wHd4N0Ts3tHJOtVirFi/7yFN0plD8qFB6O0QxduIi2
YuMuYs4YTKRMVM+/4QJAeMNAGhp4A8Cy5rg8M23YRVIaGJZVC0DKQZLptBfSiqtW
iZmAdozBoNU+KEn8CvIB7+NbYRb16JqxRrmjaFlkjg==
-----END RSA PRIVATE KEY-----
</pre>
<p><span class="target" id="encrypt-with-public-key">encrypt with public key</span>:</p>
<pre class="literal-block">
&gt;&gt;&gt; key = RSAKey()
&gt;&gt;&gt; key.fromPEM_PublicKey( public_key_data )
&gt;&gt;&gt;
&gt;&gt;&gt; key.maxInputSize()
86
&gt;&gt;&gt; plain_text = 'my secret'
&gt;&gt;&gt; len(plain_text)
9
&gt;&gt;&gt; cipher_text = key.encrypt( plain_text )
&gt;&gt;&gt; cipher_text
'\x054\x0c\xf4)7P\x99\x85\x91\xb7\xdad\xa4\x9d\xe6s\xbd\xfd\x1f\xd4\xee\x03\x04x
\xdc\xa7Ob\x18\xa7[\xaey\x01\xf1\xb1\xb5\xa6\xec\x89\xac\xf3\xa4x\xfdy\xc8\x98\x
f8\xcaj\xb3x\xe3\xab&lt;-\xca&#64;\xe7\xbc\xef\xe8\xbb&lt;\x1dS\x9e&lt;y\xa7\xe9\x81`%\xce\xa
5\xa98\x93\xe6O\xc6EQ\x18\xc4\x87\x84b\xf5\x0fU%\xda\xc7\x0c?\xb8C\xcaiAx$\x11A\
x94\x14\x175=\xd02\xd6\x08\x18d\x8aq\t\xeb&lt;/\xd6\x1c\xb1'
</pre>
<p><span class="target" id="decrypt-with-private-key">decrypt with private key</span>:</p>
<pre class="literal-block">
&gt;&gt;&gt; key = RSAKey()
&gt;&gt;&gt; key.fromPEM_PrivateKey( private_key_data )
&gt;&gt;&gt;
&gt;&gt;&gt; new_plain_text = key.decrypt( cipher_text )
&gt;&gt;&gt; new_plain_text
'my secret'
</pre>
<p><span class="target" id="sign-with-private-key">sign with private key</span>:</p>
<pre class="literal-block">
&gt;&gt;&gt; from ncrypt.digest import Digest, DigestType
&gt;&gt;&gt;
&gt;&gt;&gt; key = RSAKey()
&gt;&gt;&gt; key.fromPEM_PrivateKey( private_key_data )
&gt;&gt;&gt;
&gt;&gt;&gt; data = 'data to be signed'
&gt;&gt;&gt;
&gt;&gt;&gt; digestType = DigestType( 'SHA1' )
&gt;&gt;&gt; digest = Digest( digestType ).digest( data )
&gt;&gt;&gt;
&gt;&gt;&gt; signature = key.sign( digest, digestType )
&gt;&gt;&gt; signature
'2\xbf\xe6\x97&#64;\xa2vx\xb4\xb5\x99\xa7w\xd6\xb7\x8fs\xf6\xda\x08\xd2\x81\xa8\xf0\
x80=9\xc7\xe2\x0b\xb1\x13\\)cc\xafx\x02\xf8\x95\x00\xdc\xaa\x06\x96\x1e6\xb8N\x8
8\xfb\xe7\xc5\xfa\x83\xf4\x81}&quot;uK[\xbd\x03\x15\x9cE\xb0\xa1\x9cZ\x888l\x8b\x1dn(
\t\x8e(\x0b\r\xa4q\xd9\x14\xb1\x9c.+&quot;\xa7\xec\x00,\x8b6\x9a\xc9E\xdd\xb3P\x16\xd
1\xc5\x89M\xa0\x0f\x8fP\xed\x14\xa3l\xad\xd2U\xd2z\x03\xaa\x18\xf7\xbd'
</pre>
<p><span class="target" id="verify-signature-with-public-key">verify signature with public key</span>:</p>
<pre class="literal-block">
&gt;&gt;&gt; key = RSAKey()
&gt;&gt;&gt; key.fromPEM_PublicKey( public_key_data )
&gt;&gt;&gt;
&gt;&gt;&gt; key.verify( signature, digest, digestType )
# throws RSAError if verification failed
</pre>
</div>
<div class="section">
<h1><a id="ncrypt-dh" name="ncrypt-dh">ncrypt.dh</a></h1>
<pre class="literal-block">
Coming soon...
</pre>
</div>
<div class="section">
<h1><a id="ncrypt-x509" name="ncrypt-x509">ncrypt.x509</a></h1>
<pre class="literal-block">
Coming soon...
</pre>
</div>
<div class="section">
<h1><a id="ncrypt-ssl" name="ncrypt-ssl">ncrypt.ssl</a></h1>
<pre class="literal-block">
Coming soon...
</pre>
</div>
</div>
</body>
</html>
